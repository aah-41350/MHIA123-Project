version: "3.8"

services:
  devcontainer:
    build:
      context: .
      dockerfile: Dockerfile
    privileged: true       # required for tailscaled networking
    security_opt:
      - seccomp:unconfined
    environment:
      TS_AUTHKEY: ${TS_AUTHKEY}
    volumes:
      - ..:/workspaces:cached
      - tailscale-state:/var/lib/tailscale
      - tailscale-run:/var/run/tailscale
    command: /bin/bash -c "/usr/local/bin/dev-start.sh"
    network_mode: bridge

volumes:
  tailscale-state:
  tailscale-run:
